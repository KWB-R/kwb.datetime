<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Converting Text to Time Objects • kwb.datetime</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Converting Text to Time Objects">
<meta property="og:description" content="kwb.datetime">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">kwb.datetime</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/text_to_posixct.html">Converting Text to Time Objects</a>
    </li>
    <li>
      <a href="../articles/timezones.html">Exkurs Zeitzonen (in German)</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/kwb-r/kwb.datetime/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="text_to_posixct_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Converting Text to Time Objects</h1>
                        <h4 class="author">Hauke Sonnenberg</h4>
            
            <h4 class="date">2021-07-07</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/kwb-r/kwb.datetime/blob/master/vignettes/text_to_posixct.Rmd"><code>vignettes/text_to_posixct.Rmd</code></a></small>
      <div class="hidden name"><code>text_to_posixct.Rmd</code></div>

    </div>

    
    
<p>This tutorial describes how to convert text timestamps to <code>POSIXct</code> objects. The conversion becomes necessary when time differences are to be calculated. We consider two cases that differ in the way that the time recording device operates its clock:</p>
<ul>
<li>Case 1: the clock switches between standard (winter) time and summer time.</li>
<li>Case 2: the clock does not switch between standard (winter) time and summer time but stays in standard time over the whole year.</li>
</ul>
<p>In both cases, using the base R function <code><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct()</a></code> to convert text timestamps to <code>POSIXct</code> objects may lead to unintended results (as detailed below).</p>
<p>This package contains a function <code><a href="../reference/textToEuropeBerlinPosix.html">textToEuropeBerlinPosix()</a></code> that is a wrapper around <code><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct()</a></code> but that is specialised on the two above cases. It returns <code>POSIXct</code> objects in time zone “Europe/Berlin” and can handle timestamps from both of the above cases as input.</p>
<div id="creation-of-example-timestamps" class="section level2">
<h2 class="hasAnchor">
<a href="#creation-of-example-timestamps" class="anchor"></a>Creation of example timestamps</h2>
<p>We start by creating text timestamps as they could have been recorded by a measuring device.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Define first and last timestamps</span>
<span class="va">from</span> <span class="op">&lt;-</span> <span class="st">"2019-01-01"</span>
<span class="va">to</span> <span class="op">&lt;-</span> <span class="st">"2020-01-01"</span>
<span class="va">step</span> <span class="op">&lt;-</span> <span class="fl">3600</span> <span class="co"># seconds, i.e. one timestamp per hour</span>

<span class="co"># Case 1: local time, i.e. standard time in winter, summer time in summer</span>
<span class="va">tz</span> <span class="op">&lt;-</span> <span class="st">"Europe/Berlin"</span>
<span class="va">times_local</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="va">from</span>, <span class="va">tz</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="va">to</span>, <span class="va">tz</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">step</span><span class="op">)</span>

<span class="co"># Case 2: always standard time (Note that GMT-1 refers to UTC+1!)</span>
<span class="va">tz</span> <span class="op">&lt;-</span> <span class="st">"Etc/GMT-1"</span>
<span class="va">times_standard</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="va">from</span>, <span class="va">tz</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="va">to</span>, <span class="va">tz</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">step</span><span class="op">)</span></code></pre></div>
<p>In both cases, all time differences are one (hour), as intended:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">times_local</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span>
<span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">times_standard</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>We use <code><a href="https://rdrr.io/r/base/format.html">format()</a></code> to simulate that the timestamps are recorded in a certain local format:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">format</span> <span class="op">&lt;-</span> <span class="st">"%d.%m.%y %H:%M"</span>
<span class="va">timestamps_local</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">times_local</span>, format <span class="op">=</span> <span class="va">format</span><span class="op">)</span>
<span class="va">timestamps_standard</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">times_standard</span>, format <span class="op">=</span> <span class="va">format</span><span class="op">)</span></code></pre></div>
<p>Show the first three timestamps in each case to check whether the format was applied as intended:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html">writeLines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">timestamps_local</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; 01.01.19 00:00</span>
<span class="co">#&gt; 01.01.19 01:00</span>
<span class="co">#&gt; 01.01.19 02:00</span>
<span class="fu"><a href="https://rdrr.io/r/base/writeLines.html">writeLines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">timestamps_standard</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; 01.01.19 00:00</span>
<span class="co">#&gt; 01.01.19 01:00</span>
<span class="co">#&gt; 01.01.19 02:00</span></code></pre></div>
<p>Note that one of the local timestamps appears twice:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">timestamps_local</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="va">timestamps_local</span><span class="op">)</span><span class="op">]</span>
<span class="co">#&gt; [1] "27.10.19 02:00"</span></code></pre></div>
<p>In contrast, the standard timestamps are all unique:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="va">timestamps_standard</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] FALSE</span></code></pre></div>
</div>
<div id="case-1-clock-switches-between-standard-time-and-summer-time" class="section level2">
<h2 class="hasAnchor">
<a href="#case-1-clock-switches-between-standard-time-and-summer-time" class="anchor"></a>Case 1: Clock switches between standard time and summer time</h2>
<p>In this case the function <code><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct()</a></code> may return unexpected results. These are caused by duplicates in the input vector of text timestamps. In the case considered in this chapter, duplicated timestamps are absolutely valid. They result from shifting time back from summer time to standard time. Let’s see what happens if we call <code><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct()</a></code> on the vector of local timestamps:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Convert text timestamps to POSIXct objects</span>
<span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="va">timestamps_local</span>, tz <span class="op">=</span> <span class="st">"Europe/Berlin"</span>, format <span class="op">=</span> <span class="va">format</span><span class="op">)</span></code></pre></div>
<div id="problem" class="section level3">
<h3 class="hasAnchor">
<a href="#problem" class="anchor"></a>Problem</h3>
<p>Even though time zone and time format were set correctly, the vector of returned <code>POSIXct</code> objects is corrupt. We can see the problem when looking at the time differences:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">times</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    0 3600 7200 </span>
<span class="co">#&gt;    1 8758    1</span></code></pre></div>
<p>Not all time differences are one hour (3600 seconds) anymore! Once there is no time difference, i.e. two adjacent times are identical, and once there is a time difference of two hours (7200 seconds), i.e. one hour is skipped. Read further down for the reason and for a function allowing to further investigate the problem.</p>
</div>
<div id="solution" class="section level3">
<h3 class="hasAnchor">
<a href="#solution" class="anchor"></a>Solution</h3>
<p>Use the function <code>textToEuropeBerlinPOSIX()</code> to do the conversion. It interprets ambiguous timestamps correctly, provided that they are given in chronological order. See below for details.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Convert text timestamps to POSIXct objects</span>
<span class="va">times_local_from_text</span> <span class="op">&lt;-</span> <span class="fu">kwb.datetime</span><span class="fu">::</span><span class="fu"><a href="../reference/textToEuropeBerlinPosix.html">textToEuropeBerlinPosix</a></span><span class="op">(</span>
  <span class="va">timestamps_local</span>, format <span class="op">=</span> <span class="va">format</span>
<span class="op">)</span>
<span class="co">#&gt; Converting 8761 timestamps to POSIXct ... ok. (0.14s)</span></code></pre></div>
<p>The created <code>POSIXct</code> objects are now identical to the original ones:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">times_local</span>, <span class="va">times_local_from_text</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
</div>
</div>
<div id="case-2-clock-stays-in-standard-time" class="section level2">
<h2 class="hasAnchor">
<a href="#case-2-clock-stays-in-standard-time" class="anchor"></a>Case 2: Clock stays in standard time</h2>
<p>What happens in this case, when applying <code><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct()</a></code> on the timestamps?</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="va">timestamps_standard</span>, tz <span class="op">=</span> <span class="st">"Europe/Berlin"</span>, format <span class="op">=</span> <span class="va">format</span><span class="op">)</span></code></pre></div>
<div id="problem-1" class="section level3">
<h3 class="hasAnchor">
<a href="#problem-1" class="anchor"></a>Problem</h3>
<p>The vector <code>timestamps_standard</code> contains timestamps that do not exist in the time zone <code>Europe/Berlin</code> (for details, see below). Unfortunately, the function <code><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct()</a></code> does not give a warning about this. We convince ourselves that something went wrong by looking at the frequencies of the time differences:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">times</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    1    2 </span>
<span class="co">#&gt; 8757    1</span></code></pre></div>
<p>Not all differences are one hour (3600 seconds) as expected. Once the time difference is zero, i.e. two adjacent times are identical, and once there is a time difference of two hours (7200 seconds), i.e. one hour is skipped. This is the behaviour on a Linux system, on Windows we would get a different, but also unintended result.</p>
</div>
<div id="solution-1" class="section level3">
<h3 class="hasAnchor">
<a href="#solution-1" class="anchor"></a>Solution</h3>
<p>Use the function <code>textToEuropeBerlinPOSIX()</code> to do the conversion. Set <code>switches = FALSE</code> to tell the function that the timestamps were recorded by a clock that does not switch between standard time and summer time:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Convert text timestamps to POSIXct objects</span>
<span class="va">times_standard_from_text</span> <span class="op">&lt;-</span> <span class="fu">kwb.datetime</span><span class="fu">::</span><span class="fu"><a href="../reference/textToEuropeBerlinPosix.html">textToEuropeBerlinPosix</a></span><span class="op">(</span>
  <span class="va">timestamps_standard</span>, format <span class="op">=</span> <span class="va">format</span>, switches <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span>
<span class="co">#&gt; Converting 8761 timestamps to POSIXct ... ok. (0.05s)</span></code></pre></div>
<p>The created <code>POSIXct</code> objects are now (almost) identical to the original ones. The only difference is the time zone attribute that is “Etc/GMT-1” in the original timestamps but “Europe/Berlin” in the timestamps provided by <code><a href="../reference/textToEuropeBerlinPosix.html">textToEuropeBerlinPosix()</a></code>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">times_standard</span>, <span class="st">"tzone"</span><span class="op">)</span>
<span class="co">#&gt; [1] "Etc/GMT-1"</span>
<span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">times_standard_from_text</span>, <span class="st">"tzone"</span><span class="op">)</span>
<span class="co">#&gt; [1] "Europe/Berlin"</span></code></pre></div>
<p>We set the time zone of the original times to “Europe/Berlin” (that does not change the underlying time information!) in order to check for identity:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">times_standard</span>, <span class="st">"tzone"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"Europe/Berlin"</span>
<span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">times_standard</span>, <span class="va">times_standard_from_text</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>See vignette <a href="timezones.html">“Exkurs Zeitzonen”</a> (in German!) for details on this case.</p>
</div>
</div>
<div id="background-and-details" class="section level1">
<h1 class="hasAnchor">
<a href="#background-and-details" class="anchor"></a>Background and Details</h1>
<p>In R, time information are stored in objects of class <code>POSIXct</code>. The function <code><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct()</a></code> is used to convert character strings representing points in time into the corresponding <code>POSIXct</code> objects. This chapter points out some important details about this function.</p>
<p>Problems may arise with times recorded in time zones that change for Daylight Saving. This is the case for the time zone “Europe/Berlin” that is used in the following example. In this time zone, the time is given in Central European Time (CET) in winter and in Central European Summer Time (CEST) in summer.</p>
<div id="when-does-summer-time-startend" class="section level2">
<h2 class="hasAnchor">
<a href="#when-does-summer-time-startend" class="anchor"></a>When does Summer Time start/end?</h2>
<p>Use the function <code><a href="../reference/date_range_CEST.html">date_range_CEST()</a></code> to find out at what days summer time starts and ends, respectively:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">kwb.datetime</span><span class="fu">::</span><span class="fu"><a href="../reference/date_range_CEST.html">date_range_CEST</a></span><span class="op">(</span><span class="fl">2017</span><span class="op">:</span><span class="fl">2019</span><span class="op">)</span>
<span class="co">#&gt;      begin        end         </span>
<span class="co">#&gt; 2017 "2017-03-26" "2017-10-29"</span>
<span class="co">#&gt; 2018 "2018-03-25" "2018-10-28"</span>
<span class="co">#&gt; 2019 "2019-03-31" "2019-10-27"</span></code></pre></div>
<p>Note that this function returns character strings and not, for example, <code>Date</code> objects.</p>
</div>
<div id="example-reading-local-timestamps-in-berlin-germany" class="section level2">
<h2 class="hasAnchor">
<a href="#example-reading-local-timestamps-in-berlin-germany" class="anchor"></a>Example: Reading local timestamps in Berlin, Germany</h2>
<p>Imagine a measuring device taking measurements every 30 minutes at some location in Berlin, Germany. The clock of the device is configured to switch between standard time and daylight saving time (summer time) and vice versa. In 2017, on October 29, when summer time is reverted back to standard time, the recorded timestamps around the time shift are:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Define timestamps (character)</span>
<span class="va">timestamps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
  <span class="st">"2017-10-29 01:30:00"</span>, <span class="co"># 1: CEST</span>
  <span class="st">"2017-10-29 02:00:00"</span>, <span class="co"># 2: CEST</span>
  <span class="st">"2017-10-29 02:30:00"</span>, <span class="co"># 3: CEST</span>
  <span class="st">"2017-10-29 02:00:00"</span>, <span class="co"># 4: CET</span>
  <span class="st">"2017-10-29 02:30:00"</span>, <span class="co"># 5: CET</span>
  <span class="st">"2017-10-29 03:00:00"</span>  <span class="co"># 6: CET</span>
<span class="op">)</span></code></pre></div>
<p>The timestamps “02:00” and “02:30” appear twice, at indices 2 and 3, respectively, first and at indices 4 and 5, respectively, second. This is because at 03:00 (CEST) the clock is set back to 02:00 (CET). The first occurrences of the two timestamps refer to summer time (CEST) whereas the second occurrences refer to standard time (CET).</p>
<div id="what-is-the-problem" class="section level3">
<h3 class="hasAnchor">
<a href="#what-is-the-problem" class="anchor"></a>What is the problem?</h3>
<p>What happens if we convert these timestamps to time objects? Using <code><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct()</a></code> and the (correct) time zone “Europe/Berlin”, we get the following vector of time objects:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Convert timestamps to POSIXct and print them</span>
<span class="op">(</span><span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="va">timestamps</span>, tz <span class="op">=</span> <span class="st">"Europe/Berlin"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] "2017-10-29 01:30:00 CEST" "2017-10-29 02:00:00 CEST"</span>
<span class="co">#&gt; [3] "2017-10-29 02:30:00 CEST" "2017-10-29 02:00:00 CEST"</span>
<span class="co">#&gt; [5] "2017-10-29 02:30:00 CEST" "2017-10-29 03:00:00 CET"</span></code></pre></div>
<p>The function cannot distinguish between the first and second occurrences of the times 02:00 and 02:30. The output and the following plot reveal that the timestamps between 02:00 and 03:00 (exclusive) are always interpreted as being in summer time (CEST).</p>
<p><img src="text_to_posixct_files/figure-html/unnamed-chunk-19-1.png" width="480"></p>
</div>
<div id="what-is-the-solution-step-by-step" class="section level3">
<h3 class="hasAnchor">
<a href="#what-is-the-solution-step-by-step" class="anchor"></a>What is the solution (step by step)?</h3>
<p>How can we tell R that the first occurrences of 02:00 and 02:30 refer to CEST and the second ocurrences refer to CET? We could try the following:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span>tz <span class="op">=</span> <span class="st">"Europe/Berlin"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
  <span class="st">"2017-10-29 01:30:00 CEST"</span>,
  <span class="st">"2017-10-29 02:00:00 CEST"</span>,
  <span class="st">"2017-10-29 02:30:00 CEST"</span>,
  <span class="st">"2017-10-29 02:00:00 CET"</span>,
  <span class="st">"2017-10-29 02:30:00 CET"</span>,
  <span class="st">"2017-10-29 03:00:00 CET"</span>
<span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] "2017-10-29 01:30:00 CEST" "2017-10-29 02:00:00 CEST"</span>
<span class="co">#&gt; [3] "2017-10-29 02:30:00 CEST" "2017-10-29 02:00:00 CEST"</span>
<span class="co">#&gt; [5] "2017-10-29 02:30:00 CEST" "2017-10-29 03:00:00 CET"</span></code></pre></div>
<p><strong>Unfortunately, this does not work!</strong> Again, everything between 02:00 and 03:00 (exclusive) is assumed to refer to CEST, as the output above indicates. However, R accepts a format in which the number of hours ahead of Coordinated Universal Time (UTC) is indicated in the timestamps. In our example this looks as follows:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">iso_timestamps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
  <span class="st">"2017-10-29 01:30:00+0200"</span>,
  <span class="st">"2017-10-29 02:00:00+0200"</span>,
  <span class="st">"2017-10-29 02:30:00+0200"</span>,
  <span class="st">"2017-10-29 02:00:00+0100"</span>,
  <span class="st">"2017-10-29 02:30:00+0100"</span>,
  <span class="st">"2017-10-29 03:00:00+0100"</span>
<span class="op">)</span></code></pre></div>
<p>Timestamps in CEST are two hours (and zero minutes) ahead of UTC. This is indicated in the timestamp by the ending <em>+0200</em>. Timestamps in CET are only one hour ahead of UTC and thus indicated by <em>+0100</em>. Timestamps given in this format can be converted to POSIXct objects by setting the <code>format</code> argument of the <code><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct()</a></code> function to <code>"%F %T%z"</code>:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="va">iso_timestamps</span>, tz <span class="op">=</span> <span class="st">"Europe/Berlin"</span>, format <span class="op">=</span> <span class="st">"%F %T%z"</span><span class="op">)</span>
<span class="co">#&gt; [1] "2017-10-29 01:30:00 CEST" "2017-10-29 02:00:00 CEST"</span>
<span class="co">#&gt; [3] "2017-10-29 02:30:00 CEST" "2017-10-29 02:00:00 CET" </span>
<span class="co">#&gt; [5] "2017-10-29 02:30:00 CET"  "2017-10-29 03:00:00 CET"</span></code></pre></div>
<p>For the meaning of the placeholders %F, %T and %z, respectively, in the format string, see <code><a href="https://rdrr.io/r/base/strptime.html">?strftime</a></code>.</p>
<p>The package kwb.datetime provides a function <code><a href="../reference/isoToLocaltime.html">isoToLocaltime()</a></code> that does the same:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">kwb.datetime</span><span class="fu">::</span><span class="fu"><a href="../reference/isoToLocaltime.html">isoToLocaltime</a></span><span class="op">(</span><span class="va">iso_timestamps</span><span class="op">)</span>
<span class="co">#&gt; Converting 6 timestamps ... ok.</span>
<span class="co">#&gt; [1] "2017-10-28 23:30:00 UTC" "2017-10-29 00:00:00 UTC"</span>
<span class="co">#&gt; [3] "2017-10-29 00:30:00 UTC" "2017-10-29 01:00:00 UTC"</span>
<span class="co">#&gt; [5] "2017-10-29 01:30:00 UTC" "2017-10-29 02:00:00 UTC"</span></code></pre></div>
<p>In both cases, the timestamps are interpreted correctly, as also shown in this plot:</p>
<p><img src="text_to_posixct_files/figure-html/unnamed-chunk-24-1.png" width="480"></p>
<p>Unfortunately, the timestamps logged by measuring devices often do not contain the additional information on the UTC offset. For this case the package kwb.datetime provides functions that can be applied in a chain to perform a three step process:</p>
<p><strong>Step 1:</strong> Use the function <code><a href="../reference/utcOffsetBerlinTime.html">utcOffsetBerlinTime()</a></code> to determine the UTC offsets (for timestamps given in time zone “Europe/Berlin”):</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Guess and print the UTC offsets for the given timestamps</span>
<span class="op">(</span><span class="va">offsets</span> <span class="op">&lt;-</span> <span class="fu">kwb.datetime</span><span class="fu">::</span><span class="fu"><a href="../reference/utcOffsetBerlinTime.html">utcOffsetBerlinTime</a></span><span class="op">(</span><span class="va">timestamps</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 2 2 2 1 1 1</span></code></pre></div>
<p>This function requires the timestamps to be sorted in increasing order. Otherwise it cannot decide between CEST and CET for possibly unambiguous timestamps between 02:00 and 03:00 at the day of reverting time from CEST back to CET.</p>
<p><strong>Step 2:</strong> Use these offsets to create timestamps in full ISO 8601 format, i.e. ending in either <em>+0200</em> (when referring to CEST) or in <em>+0100</em> (when referring to CET):</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create ISO 8601 timestamps and print them</span>
<span class="op">(</span><span class="va">iso_timestamps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"%s%+03d00"</span>, <span class="va">timestamps</span>, <span class="va">offsets</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] "2017-10-29 01:30:00+0200" "2017-10-29 02:00:00+0200"</span>
<span class="co">#&gt; [3] "2017-10-29 02:30:00+0200" "2017-10-29 02:00:00+0100"</span>
<span class="co">#&gt; [5] "2017-10-29 02:30:00+0100" "2017-10-29 03:00:00+0100"</span></code></pre></div>
<p><strong>Step 3:</strong> Use the function <code><a href="../reference/isoToLocaltime.html">isoToLocaltime()</a></code> to convert these new timestamps from <code>character</code> into their corresponding <code>POSIXct</code> objects:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create POSIXct-objects in time zone "Europe/Berlin" and print them</span>
<span class="op">(</span><span class="fu">kwb.datetime</span><span class="fu">:::</span><span class="fu"><a href="../reference/isoToLocaltime.html">isoToLocaltime</a></span><span class="op">(</span><span class="va">iso_timestamps</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Converting 6 timestamps ... ok.</span>
<span class="co">#&gt; [1] "2017-10-28 23:30:00 UTC" "2017-10-29 00:00:00 UTC"</span>
<span class="co">#&gt; [3] "2017-10-29 00:30:00 UTC" "2017-10-29 01:00:00 UTC"</span>
<span class="co">#&gt; [5] "2017-10-29 01:30:00 UTC" "2017-10-29 02:00:00 UTC"</span></code></pre></div>
</div>
<div id="what-is-the-solution-one-step" class="section level3">
<h3 class="hasAnchor">
<a href="#what-is-the-solution-one-step" class="anchor"></a>What is the solution (one step)?</h3>
<p>The three steps presented above are performed within the function <code><a href="../reference/textToEuropeBerlinPosix.html">textToEuropeBerlinPosix()</a></code> so that you can do the conversion of the original <code>timestamps</code> by calling:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">kwb.datetime</span><span class="fu">::</span><span class="fu"><a href="../reference/textToEuropeBerlinPosix.html">textToEuropeBerlinPosix</a></span><span class="op">(</span><span class="va">timestamps</span><span class="op">)</span>
<span class="co">#&gt; Guessing time format ... ok. (0.05s) </span>
<span class="co">#&gt; Converting 6 timestamps to POSIXct ... ok. (0.01s)</span>
<span class="co">#&gt; [1] "2017-10-29 01:30:00 CEST" "2017-10-29 02:00:00 CEST"</span>
<span class="co">#&gt; [3] "2017-10-29 02:30:00 CEST" "2017-10-29 02:00:00 CET" </span>
<span class="co">#&gt; [5] "2017-10-29 02:30:00 CET"  "2017-10-29 03:00:00 CET"</span></code></pre></div>
</div>
</div>
<div id="analyse-a-sequence-of-posixct-objects" class="section level2">
<h2 class="hasAnchor">
<a href="#analyse-a-sequence-of-posixct-objects" class="anchor"></a>Analyse a sequence of POSIXct objects</h2>
<p>The package contains a function <code><a href="../reference/getEqualStepRanges.html">getEqualStepRanges()</a></code> that helps find unexpected changes in the time step within a vector of <code>POSIXct</code>. Applied to the example vector <code>times_local</code> from above, this function finds exactly one consistent sequence of times in which the time step is constantly one hour:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">kwb.datetime</span><span class="fu">::</span><span class="fu"><a href="../reference/getEqualStepRanges.html">getEqualStepRanges</a></span><span class="op">(</span><span class="va">times_local</span><span class="op">)</span>
<span class="co">#&gt;   from   to  from_time    to_time    step</span>
<span class="co">#&gt; 1    1 8761 2019-01-01 2020-01-01 1 hours</span></code></pre></div>
<p>As already shown above, using <code><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct()</a></code> directly on the vector of text timestamps does not return the correct <code>times</code>. Using <code><a href="../reference/getEqualStepRanges.html">getEqualStepRanges()</a></code> helps understand the problem. It shows four different sub-sequences within <code>times</code> in each of which the time step differs from the time step in the previous sub-sequence.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># (Badly) Convert to POSIXct</span>
<span class="va">bad_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="va">timestamps_local</span>, tz <span class="op">=</span> <span class="st">"Europe/Berlin"</span>, format <span class="op">=</span> <span class="va">format</span><span class="op">)</span>

<span class="co"># Get information on the contained sub-sequences</span>
<span class="va">ranges</span> <span class="op">&lt;-</span> <span class="fu">kwb.datetime</span><span class="fu">::</span><span class="fu"><a href="../reference/getEqualStepRanges.html">getEqualStepRanges</a></span><span class="op">(</span><span class="va">bad_times</span><span class="op">)</span>

<span class="co"># Print the sub-sequences</span>
<span class="va">ranges</span>
<span class="co">#&gt;   from   to           from_time             to_time      step</span>
<span class="co">#&gt; 1    1 7178 2019-01-01 00:00:00 2019-10-27 02:00:00 3600 secs</span>
<span class="co">#&gt; 2 7178 7179 2019-10-27 02:00:00 2019-10-27 02:00:00    0 secs</span>
<span class="co">#&gt; 3 7179 7180 2019-10-27 02:00:00 2019-10-27 03:00:00 7200 secs</span>
<span class="co">#&gt; 4 7180 8761 2019-10-27 03:00:00 2020-01-01 00:00:00 3600 secs</span>

<span class="co"># Plot the sub-sequences</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ranges</span><span class="op">)</span></code></pre></div>
<p><img src="text_to_posixct_files/figure-html/unnamed-chunk-30-1.png" width="576"></p>
<p>What happened? The timestamp <code>2019-10-27 02:00</code> appears twice! Once in Central European Summer Time (CEST) and once in Central European Time (CET). As shown above, using the function <code><a href="../reference/textToEuropeBerlinPosix.html">textToEuropeBerlinPosix()</a></code> can solve the problem:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Reformat the timestamps to ISO format</span>
<span class="va">iso</span> <span class="op">&lt;-</span> <span class="fu">kwb.datetime</span><span class="fu">::</span><span class="fu"><a href="../reference/reformatTimestamp.html">reformatTimestamp</a></span><span class="op">(</span><span class="va">timestamps_local</span>, <span class="va">format</span><span class="op">)</span>

<span class="co"># (Correctly) Convert to POSIXct</span>
<span class="va">good_times</span> <span class="op">&lt;-</span> <span class="fu">kwb.datetime</span><span class="fu">::</span><span class="fu"><a href="../reference/textToEuropeBerlinPosix.html">textToEuropeBerlinPosix</a></span><span class="op">(</span><span class="va">iso</span><span class="op">)</span>
<span class="co">#&gt; Guessing time format ... ok. (0.01s) </span>
<span class="co">#&gt; Converting 8761 timestamps to POSIXct ... ok. (0.15s)</span>

<span class="co"># Show the contained sub-sequences (should be only one now!)</span>
<span class="fu">kwb.datetime</span><span class="fu">::</span><span class="fu"><a href="../reference/getEqualStepRanges.html">getEqualStepRanges</a></span><span class="op">(</span><span class="va">good_times</span><span class="op">)</span>
<span class="co">#&gt;   from   to  from_time    to_time    step</span>
<span class="co">#&gt; 1    1 8761 2019-01-01 2020-01-01 1 hours</span></code></pre></div>
<p>Check if the original date and time objects could be reproduced:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Explicitly set the time zone before comparing</span>
<span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">good_times</span>, <span class="st">"tzone"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"Europe/Berlin"</span>

<span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">good_times</span>, <span class="va">times_local</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://github.com/hsonne">Hauke Sonnenberg</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
